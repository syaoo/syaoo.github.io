iptables详细教程：基础、架构、清空规则、追加规则、应用实例 - Lesca 技术宅: https://lesca.me/archives/iptables-tutorial-structures-configuratios-examples.html

iptables 添加，删除，查看，修改«海底苍鹰(tank)博客: http://blog.51yip.com/linux/1404.html

[Iptables 之NAT端口转发设置 - 散尽浮华 - 博客园](https://www.cnblogs.com/kevingrace/p/5865792.html)
[linux下用iptables做本机端口转发方法_zzhongcy的专栏-CSDN博客](https://blog.csdn.net/zzhongcy/article/details/42738285)

Linux系统启用端口转发（NAT）功能
```
# 非永久修改
echo 1 > /proc/sys/net/ipv4/ip_forward  
# 永久修改
vi /etc/sysctl.conf
net.ipv4.ip_forward=1
sysctl -p
```

sudo iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to-destination 192.168.0.2:80
sudo iptables -t nat -A POSTROUTING -p tcp -d 192.168.0.2 --dport 80 -j SNAT --to-source 127.0.0.1

sudo iptables -t nat -A PREROUTING -p tcp --dport 222 -j DNAT --to-destination 192.168.0.2:22
sudo iptables -t nat -A POSTROUTING -p tcp -d 192.168.0.2 --dport 22 -j SNAT --to-source 192.168.0.1

sudo iptables -t nat -A PREROUTING -p tcp --dport 5922 -j DNAT --to-destination 192.168.0.2:5922
sudo iptables -t nat -A POSTROUTING -p tcp -d 192.168.0.2 --dport 5922 -j SNAT --to-source 192.168.0.1

转发到不同端口

```
iptables -t nat -A PREROUTING -p tcp -m tcp --dport 222 -j DNAT --to-destination 172.16.4.129:22 
iptables -t nat -A POSTROUTING -d 172.16.4.0/16 -p tcp -m tcp --dport 22 -j SNAT --to-source 172.16.4.1
```

转发到相同端口

```
iptables -t nat -A PREROUTING -p tcp -m tcp --dport 5980:5999 -j DNAT --to 172.16.4.129
iptables -t nat -A POSTROUTING -p tcp -m tcp --dport 5980:5999 -j MASQUERADE
```

也可编辑iptables-save生成的文件`/etc/sysconfig/iptables`(RHEL 5、RHEL 6)，在相应的规则区块添加规则：

```
# Generated by iptables-save v1.4.7 on Mon Sep 21 14:21:18 2020
*nat
:PREROUTING ACCEPT [46:5259]
:POSTROUTING ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A PREROUTING -p tcp -m tcp --dport 222 -j DNAT --to-destination 172.16.4.129:22 
-A POSTROUTING -d 172.16.4.0/16 -p tcp -m tcp --dport 22 -j SNAT --to-source 172.16.4.1
-A PREROUTING -p tcp -m tcp --dport 5980:5999 -j DNAT --to 172.16.4.129
-A POSTROUTING -p tcp -m tcp --dport 5980:5999 -j MASQUERADE
COMMIT
# Completed on Mon Sep 21 14:21:18 2020
# Generated by iptables-save v1.4.7 on Mon Sep 21 14:21:18 2020
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [1328:288386]
:RH-Firewall-1-INPUT - [0:0]
-A INPUT -j RH-Firewall-1-INPUT 
-A FORWARD -j RH-Firewall-1-INPUT 
-A RH-Firewall-1-INPUT -i lo -j ACCEPT 
-A RH-Firewall-1-INPUT -p icmp -m icmp --icmp-type any -j ACCEPT 
-A RH-Firewall-1-INPUT -p esp -j ACCEPT 
-A RH-Firewall-1-INPUT -p ah -j ACCEPT 
-A RH-Firewall-1-INPUT -d 224.0.0.251/32 -p udp -m udp --dport 5353 -j ACCEPT 
-A RH-Firewall-1-INPUT -p udp -m udp --dport 631 -j ACCEPT 
-A RH-Firewall-1-INPUT -p tcp -m tcp --dport 631 -j ACCEPT 
-A RH-Firewall-1-INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT 
-A RH-Firewall-1-INPUT -p tcp -m state --state NEW -m tcp --dport 21 -j ACCEPT 
-A RH-Firewall-1-INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT 
-A RH-Firewall-1-INPUT -p tcp -m state --state NEW -m tcp --dport 23 -j ACCEPT 
-A RH-Firewall-1-INPUT -p tcp -m state --state NEW -m tcp --dport 5901:5999 -j ACCEPT 
-A RH-Firewall-1-INPUT -p tcp -m state --state NEW -m tcp --dport 222 -j ACCEPT 
-A RH-Firewall-1-INPUT -j REJECT --reject-with icmp-host-prohibited 
COMMIT
# Completed on Mon Sep 21 14:21:18 2020
```

