---
title: Linuxå†…æ ¸å‡çº§
tag: ['Linux']
mathjax: false
article_header:
  type: overlay
  theme: dark
  background_color: '#203028'
  background_image:
    gradient: 'linear-gradient(135deg, rgba(34, 139, 87 , .4), rgba(139, 34, 139, .4))'
    src: /assets/images/cover0.jpg
---

è®°å½•äº†ä¸€æ¬¡æœ€ç»ˆå¤±è´¥çš„Linuxå†…æ ¸å‡çº§ä¹‹æ—…ã€‚

<!--more-->
èµ·å› æ˜¯ç»„å†…æœ‰ä¸€å°è€æ—§è®¾å¤‡å†…æœ‰ä¸€æ¬¾è€æ—§çš„è½¯ä»¶ï¼Œç”±äºå¹´ä»£ä¹…è¿œï¼ˆæœ€åçš„æ›´æ–°å¤§æ¦‚æ˜¯åœ¨2008å¹´ï¼‰ï¼Œåœ¨æ–°çš„è®¾å¤‡ä¸Šç¼–è¯‘å®‰è£…æœ‰ç‚¹éº»çƒ¦ï¼Œå°è¯•äº†å¾ˆé•¿æ—¶é—´æš‚æœªæˆåŠŸã€‚å—Linuxå¹³å°çš„Appimageæ ¼å¼è½¯ä»¶çš„å¯å‘ï¼Œæƒ³å°è¯•ç”¨ç±»ä¼¼çš„æ–¹æ³•ç›´æ¥æ‰“åŒ…è½¯ä»¶ç¯å¢ƒç§»æ¤åˆ°å…¶å®ƒè®¾å¤‡ä¸Šä½¿ç”¨ã€‚æœ€è¿‘ç»ˆäºæŠŠç³»ç»Ÿè™šæ‹ŸåŒ–äº†ï¼Œåšäº†å¤‡ä»½å°±å¯æ”¾å¿ƒå¤§èƒ†çš„æŠ˜è…¾äº†ã€‚ç”±äºç³»ç»Ÿè€æ—§ï¼ˆRHEL 5.1ï¼Œå†…æ ¸ç‰ˆæœ¬2.6.18ï¼‰ä¹‹å‰ä½¿ç”¨è¿‡çš„æ‰“åŒ…å·¥å…·linuxdeployä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œå®‰è£…äº†FUSEåå› ä¸ºå†…æ ¸å¤ªä½ä¾ç„¶ä¸èƒ½ä½¿ç”¨ï¼Œäºæ˜¯å¼€å¯å°è¯•å†…æ ¸å‡çº§ä¹‹æ—…ã€‚

## æ“ä½œæµç¨‹
1. ä¸‹è½½å†…æ ¸æºç 
    ç½‘ä¸Šæœ‰äº›èµ„æ–™ä»‹ç»ä½¿ç”¨yumå®‰è£…å†…æ ¸ï¼Œæˆ–ä¸‹è½½rpmæ–‡ä»¶å®‰è£…ï¼Œå¯æ˜¯ç”±äºç³»ç»Ÿè€æ—§å¯ç”¨çš„è½¯ä»¶æºæ²¡æœ‰å‘ç°æ‰€éœ€çš„å†…æ ¸ï¼Œæ•…æ­¤é€‰æ‹©æºç ç¼–è¯‘å®‰è£…çš„æ–¹æ³•ã€‚æºç ä¸ºç•Œä»è¿™é‡Œä¸‹è½½ğŸ‘‰http://www.kernel.org/pub/linux/kernel/ ï¼Œé€‰æ‹©æ‰€éœ€çš„ç‰ˆæœ¬ä¸‹è½½è§£å‹å³å¯ã€‚

2. å†…æ ¸é…ç½®
   é¦–å…ˆä½¿ç”¨`make menuconfig`å‘½ä»¤è¿›å…¥é…ç½®èœå•ï¼Œé…ç½®å†…æ ¸éœ€è¦å¯ç”¨çš„ç‰¹æ€§ï¼ˆå¦‚æ— ç‰¹æ®Šéœ€æ±‚é»˜è®¤å³å¯ï¼‰ã€‚ç•Œé¢ä¸Šæ–¹æœ‰æ“ä½œè¯´æ˜ï¼Œ`Y`æ˜¯é€‰æ‹©ï¼Œ`N`å–æ¶ˆé€‰æ‹©ç­‰ï¼Œè®°å¾—é…ç½®å¥½åä¿å­˜ä¸€ä¸‹ã€‚
   ![wIWXnS.png](https://s1.ax1x.com/2020/09/19/wIWXnS.png)

3. ç¼–è¯‘å®‰è£…
   ä¾æ¬¡ä½¿ç”¨`make`->`make modules`->`make modules_install`->`make install`ï¼Œå‘½ä»¤ç¼–è¯‘å®‰è£…å†…æ ¸ï¼Œç­‰å¾…å®Œæˆå³å¯ï¼Œå¤§æ¦‚åå¤šåˆ†é’Ÿå§ï¼ˆä¸åŒçš„è®¾å¤‡å¯èƒ½æœ‰æ‰€åŒºåˆ«ï¼‰ã€‚

4. ä¿®å¯åŠ¨é…ç½®
   å®‰è£…å¥½é‡å¯ä¹‹å‰éœ€è¦ä¿®æ”¹ä¸€ä¸‹å¯åŠ¨é…ç½®ï¼Œä½¿ç³»ç»Ÿä½¿ç”¨æ–°çš„å†…æ ¸å¯åŠ¨ï¼Œç¼–è¾‘`/boot/grub/grub.conf`ï¼Œä¿®æ”¹`default`çš„å€¼ï¼Œä¸‹é¢æ–‡ä»¶ä¸­åˆ—å‡ºäº†ä¸¤ä¸ªå†…æ ¸ï¼Œè¦ä½¿ç”¨æ–°å®‰è£…å•Š2.6.39å†…æ ¸åˆ™éœ€è¦æŠŠ`default`çš„å€¼æ”¹ä¸º`0`ï¼ˆä»0å¼€å§‹è®¡æ•°ï¼Œ`default=n`å³ä½¿ç”¨ç¬¬`n`ä¸ªå†…æ ¸ï¼‰ï¼Œå¦‚ä¸‹ï¼š

   ```
   # grub.conf generated by anaconda
   #
   # Note that you do not have to rerun grub after making changes to this file
   # NOTICE:  You have a /boot partition.  This means that
   #          all kernel and initrd paths are relative to /boot/, eg.
   #          root (hd0,0)
   #          kernel /vmlinuz-version ro root=/dev/sda2
   #          initrd /initrd-version.img
   #boot=/dev/sda
   default=0
   timeout=5
   splashimage=(hd0,0)/grub/splash.xpm.gz
   hiddenmenu
   title Red Hat Enterprise Linux Server (2.6.39)
           root (hd0,0)
           kernel /vmlinuz-2.6.39 ro root=LABEL=/ rhgb quiet
           initrd /initrd-2.6.39.img
   title Red Hat Enterprise Linux Server (2.6.18-53.el5PAE)
           root (hd0,0)
           kernel /vmlinuz-2.6.18-53.el5PAE ro root=/dev/sda2 rhgb quiet
        
   ```
5. é‡å¯ç³»ç»Ÿ
   ä¿®æ”¹å¥½é…ç½®åå°±å¯ä»¥é‡å¯ç³»ç»Ÿï¼Œæ¥æ›´æ¢æ–°çš„å†…æ ¸äº†ã€‚é‡å¯å‰æœ€å¥½å‡†å¤‡ä¸€ä¸ªå¯åŠ¨ç›˜ï¼Œä»¥å¤‡å¯åŠ¨å¤±è´¥æ—¶å¯ä½¿ç”¨liveç³»ç»Ÿä¿®å¤ï¼›ä½¿ç”¨Vbox/Vmwareè™šæ‹Ÿæœºçš„è¯å¯ä»¥ä½¿ç”¨å¿«ç…§åŠŸèƒ½ï¼Œé‡å¯å‰æ‰“ä¸ªå¿«ç…§ï¼Œå¯åŠ¨å¤±è´¥ç›´æ¥å›æº¯ã€‚æˆåŠŸå¯åŠ¨è¿›å…¥ç³»ç»Ÿå`uname -r`å°±å¯ä»¥çœ‹åˆ°ç³»ç»Ÿç‰ˆæœ¬å·²æ›´æ–°ã€‚

## é‡åˆ°çš„é—®é¢˜

ç¼–è¯‘å®‰è£…ï¼Œæˆ–è€…å¯åŠ¨çš„æ—¶å€™éš¾å…ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œé‡åˆ°é—®é¢˜ä¸èƒ½ç›´æ¥æ”¾å¼ƒï¼Œèµ·ç è¦å°è¯•è§£å†³ä¸€ä¸‹ï¼Œç½‘ä¸Šæœç´¢ä¸€ä¸‹æˆ–è®¸å°±æœ‰å¯è¡Œçš„è§£å†³æ–¹æ¡ˆã€‚å½“ç„¶æœ‰äº›å¯èƒ½å®¹æ˜“æ‰¾åˆ°è§£æ³•åŠå¥½ï¼Œæœ‰äº›å¯èƒ½å°±éš¾æäº†ã€‚

### ç¼–è¯‘æ—¶é”™è¯¯:gcc: error trying to exec 'cc1': execvp: No such file or directory

æœç´¢ç³»ç»Ÿå†…åä¸º`cc1`çš„æ–‡ä»¶ï¼Œå¯èƒ½æ˜¯å› ä¸ºå®‰è£…äº†å¤šä¸ªç‰ˆæœ¬ç¼–è¯‘å™¨çš„åŸå› å‘ç°æœ‰å¥½å¤šçš„ï¼Œæ‰€æœ‰é€‰æ‹©å½“å‰ä½¿ç”¨çš„ç¼–è¯‘å™¨å¯¹åº”çš„`cc1`æ‰€åœ¨çš„è·¯å¾„æ·»åŠ åˆ°ç³»ç»Ÿè·¯å¾„ï¼š

```shell
export PATH=/usr/local/gcc/bin:$PATH
```

å…¶å®ï¼Œåœ¨è¿™æ ·æ“ä½œä¹‹å‰ä»[Stack Overflow](https://stackoverflow.com/questions/11912878/gcc-error-gcc-error-trying-to-exec-cc1-execvp-no-such-file-or-directory)çœ‹åˆ°ä¸€ä¸ªæ–¹æ³•æ˜¯å®‰è£…`gcc-c++`ï¼Œè¯•äº†ä¸€ä¸‹æ²¡æœ‰æ•ˆæœã€‚

### ç¼–è¯‘æ—¶é”™è¯¯ï¼š previous declaration of â€˜syscall_trace_leaveâ€™ was here

è¿™ä¸ªé”™è¯¯æ˜¯è¿™ä¸ªç‰ˆæœ¬çš„å†…æ ¸çš„bugï¼Œ[ç”±äºptrace.hæ–‡ä»¶å¯¼è‡´çš„å†…æ ¸ç¼–è¯‘å‡ºé”™çš„è§£å†³æ–¹æ³•](https://www.cnblogs.com/xj626852095/p/3648252.html)æŒ‰ä¸‹é¢çš„æ”¹åŠ¨ä¿®æ”¹`ptrace.h`æ–‡ä»¶å³å¯ï¼Œ

```diff
--- linux-2.6.32.59/arch/x86/include/asm/ptrace.h
+++ fix_ptrace.o_compile_error/arch/x86/include/asm/ptrace.h
@@ -130,6 +130,7 @@ 
 #ifdef __KERNEL__
 
 #include <linux/init.h>
+#include <linux/linkage.h>
 
 struct cpuinfo_x86;
 struct task_struct;
@@ -142,8 +143,8 @@ 
 			 int error_code, int si_code);
 void signal_fault(struct pt_regs *regs, void __user *frame, char *where);
 
-extern long syscall_trace_enter(struct pt_regs *);
-extern void syscall_trace_leave(struct pt_regs *);
+extern asmregparm long syscall_trace_enter(struct pt_regs *);
+extern asmregparm void syscall_trace_leave(struct pt_regs *);
 
 static inline unsigned long regs_return_value(struct pt_regs *regs)
```

#### å¯åŠ¨é”™è¯¯ï¼šKernel panic â€“ not syncing: Attempted to kill init!

é‡å¯æ—¶é‡åˆ°ç±»ä¼¼çš„é”™è¯¯ï¼š

```
mount: could not find filesystem â€˜/dev/rootâ€™
setuproot: moving /dev failed: No such file or directory
setuproot: error mounting /proc: No such file or directory
setuproot: error mounting /sys: No such file or directory
switchroot: mount failed: No such file or directory
Kernel panic â€“ not syncing: Attempted to kill init!
```
è¿™ä¸ªå¯ä»¥å°è¯•åœ¨æ‰§è¡Œå®Œ`make menuconfig`åï¼Œä¿®æ”¹`/usr/src/linux-2.6.35.4/.config`å…¶ä¸­åº”è¯¥æœ‰`#CONFIG_SYSFS_DEPRECATED_V2 is not set`ä¿®æ”¹ä¸º`CONFIG_SYSFS_DEPRECATED_V2=y`ï¼›æˆ–ç›´æ¥åœ¨é…ç½®ç•Œé¢æ‰¾åˆ°`SYSFS_DEPRECATED`ç›¸å…³é…ç½®é¡¹å¯ç”¨ã€‚ç„¶åé‡æ–°ç¼–è¯‘å®‰è£…ã€‚

åœ¨å°è¯•å‡çº§åˆ°3.10ç‰ˆæœ¬æ—¶ä¹Ÿé‡åˆ°äº†ç±»ä¼¼çš„é”™è¯¯ï¼ˆä¸‹é¢ç¬¬ä¸€ä¸ªå›¾ï¼‰ï¼Œä¸è¿‡è¿™ä¸ªæ–¹æ³•å°±ä¸å¥æ•ˆäº†ã€‚ä¸çŸ¥é“æ˜¯ä¸æ˜¯å› ä¸ºç¼–è¯‘è¿‡ç¨‹çš„è­¦å‘Šæ²¡è§£å†³çš„åŸå› ï¼ˆä¸‹é¢ç¬¬äºŒä¸ªå›¾ï¼‰ã€‚

![wIIRdU.png](https://s1.ax1x.com/2020/09/19/wIIRdU.png)
![wIIWoF.png](https://s1.ax1x.com/2020/09/19/wIIWoF.png)

### kernel 3.10ç¼–è¯‘é‡åˆ°é”™è¯¯: code model 'kernel not support in the 32 bit mode
`make menuconfig` è¿›å…¥å†…æ ¸é…ç½®ï¼Œå–æ¶ˆ64ä½å†…æ ¸ã€‚

## æ€»ç»“

ç”±äº2.6.39ç‰ˆæœ¬ä¾ç„¶ä¸èƒ½æ»¡è¶³linuxdeployçš„ä½¿ç”¨ï¼Œè€Œ3.10ç‰ˆæœ¬æœ‰æ²¡æœ‰å®‰è£…æˆåŠŸï¼Œæ‰€ä»¥æ­¤æ¬¡å†…æ ¸å‡çº§çš„æŠ˜è…¾æ€»å¾—æ¥è¯´æ˜¯å¤±è´¥çš„ã€‚

---



**å‚è€ƒ**

1. [centos5.5 å†…æ ¸å‡çº§](https://my.oschina.net/rang/blog/174039)
2. [centos5.8ç³»ç»Ÿå‡çº§å†…æ ¸æ­¥éª¤_5åˆ†äº«](http://www.5sharing.com/m/view.php?aid=834)
