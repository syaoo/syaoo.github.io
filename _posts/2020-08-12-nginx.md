---
title: NGINX配置端口转发
tag: ['nginx']
article_header:
  type: overlay
  theme: dark
  background_color: '#203028'
  background_image:
    gradient: 'linear-gradient(135deg, rgba(34, 139, 87 , .4), rgba(139, 34, 139, .4))'
    src: /assets/images/cover1.jpg
---

nginx端口转发配置

<!--more-->

在主机上开启WEB服务通常使用的是非80端口，访问该服务时则需要加入相应端口如(`http://127.0.0.1:8088`)，通过nginx的端口转发功能可以实现直接使用`http://127.0.0.1`访问`8088`端口服务。功能的实现也十分简单，只需要在Nginx的配置文件server块添加相应设置即可,如： 

```shell
   server {
	    listen 80;
        server_name 127.0.0.1;
        location / {
            proxy_pass http://127.0.0.1:8088;
        }
    }
```

上面是基本的配置内容，也能看增加一些其他的设置（暂不清楚具体什么功用Orz）:

```
   server {
	    listen 80;
        server_name 127.0.0.1;
        location / {
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header Host $http_host;
            proxy_set_header X-NginX-Proxy true;
            proxy_redirect off;
            proxy_pass http://127.0.0.1:8088;
        }
    }
```

## 502 Bad Gateway

在CentOS8上按如上配置使用，出现了`502 Bad Gateway`错误，查看`/var/log/nginx/error.log`发现，有Permission denied错误

```
2020/08/12 15:50:30 [crit] 624160#0: *1 connect() to 127.0.0.1:8088 failed (13: Permission denied) while connecting to upstream, client: 192.1.2.1, server: 127.0.0.1, request: "GET / HTTP/1.1", upstream: "http://127.0.0.1:8001/", host: "192.1.2.145"
```

查找资料发现是SElinux的问题，根据[Stack overflow](https://stackoverflow.com/questions/23948527/13-permission-denied-while-connecting-to-upstreamnginx)上的回答修改Selinux的设置，后问题解决。

```shell
sudo setsebool -P httpd_can_network_connect 1
```



---

**参考**

1. [title](url)
