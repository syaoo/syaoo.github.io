---
title: CentOS安装Vbox的小问题
tag: ['tag1','tag2']
article_header:
  type: overlay
  theme: dark
  background_color: '#203028'
  background_image:
    gradient: 'linear-gradient(135deg, rgba(34, 139, 87 , .4), rgba(139, 34, 139, .4))'
    src: /assets/images/cover3.jpg
---

CentOS上，VirtualBox初次启动虚拟机时失败，及在虚拟机内安装增强工具的问题

<!--more-->

## CentOS 安装VirtualBox启动虚拟机时遇到错误
```
WARNING: The vboxdrv kernel module is not loaded. Either there is no module
         available for the current kernel (4.18.0-193.14.2.el8_2.x86_64) or it failed to
         load. Please recompile the kernel module and install it by

           sudo /sbin/vboxconfig

         You will not be able to start VMs until this problem is fixed.
Invalid MIT-MAGIC-COOKIE-1 keyQt WARNING: could not connect to display :22
Qt FATAL: This application failed to start because no Qt platform plugin could be initialized. Reinstalling the application may fix this problem.

Available platform plugins are: eglfs, linuxfb, minimal, minimalegl, offscreen, vnc, xcb.

Aborted

```
解决方法
运行下面命令

```
sudo /sbin/rcvboxdrv setup
```
若出现错误
```
vboxdrv.sh: Stopping VirtualBox services.
vboxdrv.sh: Starting VirtualBox services.
vboxdrv.sh: Building VirtualBox kernel modules.
vboxdrv.sh: failed: Look at /var/log/vbox-setup.log to find out what went wrong.
```
查看log文件，发现缺失一个库libelf-dev，安装相应的库重新运行`sudo /sbin/rcvboxdrv setup`成功后即可正常使用Vbox
```
vboxdrv.sh: Stopping VirtualBox services.
vboxdrv.sh: Starting VirtualBox services.
vboxdrv.sh: Building VirtualBox kernel modules.
```
## 虚拟机内安装增强功能

安装增强功能时遇到下面的问题，需要安装kernel header以及gcc和make，在CentOS中`dnf install kernel-devel gcc make`在Debian系统中运行`apt install 
```shell
VirtualBox Guest Additions: To build modules for other installed kernels, run
VirtualBox Guest Additions:   /sbin/rcvboxadd quicksetup <version>
VirtualBox Guest Additions: or
VirtualBox Guest Additions:   /sbin/rcvboxadd quicksetup all
VirtualBox Guest Additions: Kernel headers not found for target kernel 
4.19.0-10-amd64. Please install them and execute
  /sbin/rcvboxadd setup
VirtualBox Guest Additions: Running kernel modules will not be replaced until 
the system is restarted
```

---

**参考**
1. [title](url)
